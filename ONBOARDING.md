# LINE Letter オンボーディングガイド

## 1. アプリケーション概要

LINE Letterは、ユーザーがカスタマイズした手紙を作成し、LINEを通じて送信できるサービスです。作成した手紙は画像として保存され、LINE以外の方法でも共有できます。

### 主な機能

- **LINE認証:** LINEアカウントを利用して簡単にログインできます。
- **手紙の作成:**
    - デスクトップとモバイルに最適化された専用エディタを提供します。
    - 複数のテンプレートから背景を選択できます。
    - テキストや画像を追加して、自由にレイアウトを調整できます。
- **画像生成と保存:**
    - 作成した手紙はサーバーサイドで一枚の画像に合成されます。
    - 生成された画像はSupabase Storageに保存され、永続的なURLが発行されます。

### 技術スタック

- **フロントエンド:** Next.js (React), TypeScript, Fabric.js, Tailwind CSS
- **バックエンド:** Next.js (API Routes)
- **認証:** NextAuth.js (LINE Provider)
- **データベース/ストレージ:** Supabase
- **画像処理:** Sharp

## 2. アプリケーションフロー

1.  **サインイン (`/`)**
    - ユーザーはトップページにある「Sign in with LINE」ボタンをクリックします。
    - NextAuth.jsを介してLINEの認証が行われます。

2.  **ダッシュボード (`/dashboard`)**
    - 認証に成功すると、ダッシュボードページにリダイレクトされます。
    - ここには利用可能なサービス（現在は「LINEletter」）がカード形式で表示されます。

3.  **エディタへの遷移**
    - ユーザーが「LINEletter」サービスカードをクリックすると、デバイス（デスクトップまたはモバイル）が判定されます。
    - デスクトップユーザーは `/line-letter-desktop` へ、モバイルユーザーは `/line-letter-mobile` へと、それぞれの専用エディタページに遷移します。

4.  **手紙の作成 (`/line-letter-desktop/letter-editor`, `/line-letter-mobile/letter-editor`)**
    - Fabric.jsベースのキャンバスエディタが表示されます。
    - ユーザーは背景テンプレートを選択し、テキストや画像を追加して手紙をデザインします。

5.  **画像生成 (`/api/generate-image`)**
    - ユーザーが手紙の作成を完了すると、エディタ上の各要素（背景、テキスト、画像の位置や内容）の情報がこのAPIに送信されます。
    - サーバーサイドでは`sharp`ライブラリがこれらの情報を受け取り、各要素を合成して一枚のPNG画像を生成します。
    - 生成された画像はSupabase Storageにアップロードされ、その画像の公開URLが返されます。

6.  **手紙の保存 (`/api/save-letter`)**
    - (現状の実装では、このAPIは受け取った画像をサーバーの一時ディレクトリ `/tmp` に保存するのみです。将来的には、生成された画像のURLや関連情報（作成者、タイトルなど）をSupabaseのデータベースに保存する機能が実装されると想定されます。)

## 3. 開発の始め方

1.  **リポジトリをクローン:**
    ```bash
    git clone <repository-url>
    ```
2.  **依存関係をインストール:**
    ```bash
    npm install
    ```
3.  **環境変数を設定:**
    - `.env.local.example` を参考に `.env.local` ファイルを作成します。
    - SupabaseとLINEの認証情報を設定してください。
4.  **開発サーバーを起動:**
    ```bash
    npm run dev
    ```
    ブラウザで `http://localhost:3000` を開きます。
