# User Flow

このアプリケーションの典型的なユーザーフローを説明します。

1. **ランディングページ**
    - ユーザーはアプリケーションのトップページ (`/`) にアクセスします。
    - ログインを促すボタンが表示されます。

2. **LINEログイン**
    - ユーザーがログインボタンをクリックすると、LINEの認証画面に遷移します。
    - LINEアカウントで認証を行うと、アプリケーションにリダイレクトされます。

3. **オンボーディングページ (`/pages/app-list`)**
    - ログイン後、エディタで何ができるかを説明するオンボーディングページに遷移します。
    - ユーザーは内容を確認し、ここからエディタ画面に進みます。

4. **エディタページ (`/pages/line-letter-desktop/editor`)**
    - 手紙を作成するメイン画面です。PC 向けの UI が実装されており、モバイル版 (`/pages/line-letter-mobile/letter-editor`) はプレースホルダです。
    - 最初は海のテンプレートがセットされた1ページのみが表示されます。ページ追加ボタンからテンプレート選択モーダルを開き、背景を変更できます。
    - 編集機能:
        - テキストや画像を追加し、フォント、サイズ、色、レイヤー順などを編集できます。
        - `sparkle-effect` などのエフェクトを追加してアニメーションを設定できます。

5. **画像保存と共有**
    - 送信操作時に各ページのキャンバスを PNG に変換して Supabase Storage (`line-letter` バケット) にアップロードします。同時にエフェクト情報(JSON)も保存します。
    - Supabase の `letters` テーブルに作成者情報を、`letterImages` テーブルにページごとの画像URLとエフェクトJSONを書き込みます。
    - 保存後、LIFF の `shareTargetPicker` を起動し、閲覧用 URL (`/view?letterId=...`) を共有します。

6. **LINEで友だちに送信**
    - `shareTargetPicker` を使って、共有したい友だちやグループを選択します。
    - 選択したトークに閲覧ページの URL が共有され、受信者はブラウザ上で手紙を閲覧できます。
