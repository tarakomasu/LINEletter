# LINE Letterエディタの機能ロードマップ

このドキュメントは、LINE Letterエディタを強化するための新機能案をまとめたものです。今後の開発スプリントにおけるチェックリストとして使用できます。

## 主要な編集機能

- [ ] **元に戻す/やり直す:** 操作履歴システムを実装し、ユーザーがアクションを取り消したり、やり直したりできるようにします。
    > **実装方針:** `useReducer`と状態履歴（配列）を管理するカスタムフック`useHistory`を導入。アクション毎に状態を履歴スタックに保存し、Undo/Redoで状態を切り替えるアーキテクチャを採用します。

- [ ] **スタンプ機能:** ハートや星など、あらかじめ用意されたグラフィック要素のライブラリを提供し、キャンバスに追加できるようにします。
    > **実装方針:** スタンプ画像（SVG/PNG）を`/public/stamps`に格納。スタンプ選択用のモーダルUIを作成し、選択された画像を`fabric.Image`としてキャンバスに追加します。

- [ ] **基本図形:** 長方形、円、直線などの単純な図形を追加し、カスタマイズできるようにします。
    > **実装方針:** Fabric.js標準の`fabric.Rect` `fabric.Circle` `fabric.Line`を利用。UIから図形を選択し、インスタンスを生成してキャンバスに追加。色や枠線を変更するUIも併せて実装します。

- [ ] **整列ツール:** 複数選択したオブジェクトを整列させるツール（例: 左揃え、中央揃え、均等配置）を追加します。
    > **実装方針:** 複数選択時の`ActiveSelection`オブジェクトを取得。その座標とサイズを基準に、内部の各オブジェクトの`left` `top`を再計算して整列を実現します。

- [ ] **グループ化:** 複数のオブジェクトをグループ化し、単一のユニットとして扱えるようにします。
    > **実装方針:** Fabric.jsの`toGroup()` `toActiveSelection()`メソッドを活用。「グループ化」「グループ解除」ボタンをUIに追加し、選択状態に応じて各メソッドを呼び出します。

## テキスト表現の強化

- [ ] **高度なテキスト装飾:** 太字、斜体、下線、およびテキストの配置（左/中央/右）をサポートします。
    > **実装方針:** `fabric.IText`の`fontWeight` `fontStyle` `underline` `textAlign`プロパティを操作。UI上のトグルボタン等でこれらのプロパティを更新し、キャンバスを再描画します。

- [ ] **フォントライブラリの拡充:** Google Fontsなどのサービスと連携し、より多様なフォントを提供します。
    > **実装方針:** Google Fonts APIからフォントリストを取得し、フォント選択UIを更新。Web Font Loader等を用いて選択されたフォントを動的に読み込み、`fabric.IText`に適用します。

- [ ] **テキストエフェクト:** テキストに影、縁取り、光彩などの効果を追加するオプションを設けます。
    > **実装方針:** `fabric.IText`が持つ`shadow`（影）と`stroke`（縁取り）プロパティを利用。これらのスタイルを調整するUI（カラーピッカー、スライダー等）を実装します。

## ワークフローと操作性の向上

- [ ] **下書きの保存/読み込み:** 作成途中の手紙をアカウントに保存し、後で編集を再開できるようにします。
    > **実装方針:** `canvas.toJSON()`でキャンバス状態をJSON化し、Supabaseの`drafts`テーブルに保存。読み込み時はJSONをDBから取得し`canvas.loadFromJSON()`で復元します。

- [ ] **手紙・下書きギャラリー:** 保存した下書きや過去に送信した手紙を閲覧できる専用ページを作成します。
    > **実装方針:** Supabaseからユーザーに紐づく下書き・手紙の一覧を取得。Next.jsで新しいルート`/pages/my-letters`等を作成し、取得したデータを一覧表示します。

- [ ] **ページ管理:**
    - [ ] **ページの並べ替え:** ドラッグ＆ドロップでページの順序を変更できるインターフェースを実装します。
        > **実装方針:** `react-beautiful-dnd`等のライブラリを利用。ページ一覧のUIを作成し、ドロップ操作完了時に`pages`配列の順序を入れ替えて再描画します。
    - [ ] **ページの複製:** 現在選択しているページと全く同じコピーを作成するボタンを追加します。
        > **実装方針:** 現在アクティブなキャンバスのJSONを`canvas.toJSON()`で取得。そのJSONを元に新しいページデータを作成し、`pages`配列に追加します。

- [ ] **エディタのキャンバス操作:**
    - [ ] **ズーム:** ユーザーがキャンバスを拡大・縮小できるようにします。
        > **実装方針:** Fabric.jsの`canvas.zoomToPoint()`と`canvas.setZoom()`を利用。ズームイン・アウトボタンやスライダーUIを実装し、ズームレベルを管理します。
    - [ ] **パン（手のひらツール）:** ズームイン時にキャンバスの表示領域を移動できるようにします。
        > **実装方針:** スペースキー押下中などに、Fabric.jsの`isGrabMode`を有効化。マウスのドラッグでキャンバスを移動（パン）できるようにします。

## 高度な機能

- [ ] **レイヤーパネル:** デザインソフトのように、すべてのオブジェクトを一覧表示するパネルを実装し、選択、順序変更（z-index）、非表示、ロックを可能にします。
    > **実装方針:** キャンバスのオブジェクト配列を元にレイヤー一覧UIを生成。オブジェクトの`visible` `selectable`プロパティを操作して表示・ロックを制御。順序変更は`bringToFront` `sendToBack`等を利用します。

- [ ] **ライブプレビュー:** 受信者に最終的な手紙がどのように見えるか、編集不可能なリアルタイムプレビューを提供します。
    > **実装方針:** プレビューボタンでモーダルウィンドウを開き、現在のキャンバスのJSONデータを`loadFromJSON`で別の閲覧専用キャンバスに描画。エフェクトも再現します。

- [ ] **共有オプションの拡充:** 他のSNSやメールで手紙のURLを共有したり、リンクをコピーしたりするためのUIボタンを追加します。
    > **実装方針:** `navigator.clipboard.writeText()`を用いて閲覧URLをクリップボードにコピーするボタンを実装。各SNSの共有URLスキーマに基づき、共有リンクを生成します。

- [ ] **GIF/動画のエクスポート:** アニメーション付きの手紙を、共有可能なGIFまたは短い動画ファイルとして書き出せるようにします。
    > **実装方針:** `CCapture.js`等のライブラリを導入。アニメーション開始時にキャプチャを開始し、終了時に停止。キャプチャしたフレームをGIFまたはWebM形式でエンコードし、ダウンロードさせます。
