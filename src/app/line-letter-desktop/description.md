
# `line-letter-desktop` ディレクトリ仕様書

このドキュメントは `src/app/line-letter-desktop` ディレクトリ内のコンポーネントと機能に関する仕様を記述します。

## 概要

`line-letter-desktop` は、デスクトップユーザー向けにLINEで送信する「手紙」を作成するためのインターフェースを提供します。ユーザーはまずテンプレートを選択し、その後エディタ画面でテキストや画像を追加して手紙を完成させます。

## ファイル構成と役割

```
src/app/line-letter-desktop/
├── description.md  # このファイル
├── page.tsx        # テンプレート選択ページ
├── components/
│   └── template-card.tsx # テンプレート表示用コンポーネント
└── letter-editor/
    └── page.tsx    # 手紙編集ページ
```

### 1. `page.tsx` - テンプレート選択ページ

**役割:**
ユーザーが手紙のベースとなるテンプレートを選択するためのページです。

**機能:**
-   `./components/template-card.tsx` から `templateData` をインポートし、利用可能なすべてのテンプレートをグリッドレイアウトで表示します。
-   各テンプレートは `TemplateCard` コンポーネントとして描画されます。
-   ユーザーがテンプレートをクリックすると、そのテンプレートが選択された状態（`selectedTemplate` state）になります。選択されたカードには青いリングが表示されます。
-   「Continue」ボタンは、いずれかのテンプレートが選択されるまで無効化されています。
-   テンプレートが選択された状態で「Continue」ボタンをクリックすると、Next.jsの `useRouter` を使用して手紙編集ページ (`/line-letter-desktop/letter-editor`) に遷移します。
-   遷移先のURLには、選択されたテンプレートのIDがクエリパラメータとして付与されます (例: `?template=template1`)。

### 2. `components/template-card.tsx` - テンプレートカード

**役割:**
テンプレート選択ページに表示される個々のテンプレートカードのUIとロジックを定義します。

**機能:**
-   `templateData` という名前の配列をエクスポートします。この配列には、各テンプレートの `id`, `title`, `description`, `imageUrl` がハードコードされています。
-   `TemplateCard` コンポーネントは、`card` (テンプレート情報), `isSelected` (選択状態), `onSelect` (選択時に実行されるコールバック関数) をpropsとして受け取ります。
-   カードがクリックされると、親コンポーネントから渡された `onSelect` 関数が呼び出され、選択されたカードのIDが親に通知されます。
-   `isSelected` が `true` の場合、カードの周りにリングが表示され、選択状態を視覚的に示します。
-   テンプレートの画像、タイトル、説明を表示します。

### 3. `letter-editor/page.tsx` - 手紙編集ページ

**役割:**
`fabric.js` を利用した多機能な手紙エディタです。ユーザーはここでテキストや画像を追加・編集できます。

**機能:**
-   **複数ページ管理:**
    -   手紙は複数のページを持つことができます (`pages` state)。
    -   初期状態では、背景が `/template-papers/sea.png` に設定された1ページ目が存在します。
    -   「Add Page」ボタンをクリックすると、モーダルが開き、新しいページの背景テンプレートを選択できます。選択すると新しいページが手紙の末尾に追加されます。
-   **Fabric.jsキャンバス:**
    -   各ページは個別の `<canvas>` 要素と `fabric.Canvas` インスタンスに対応します。
    -   `useRef` を使用して、各キャンバスインスタンス (`fabricInstances`) とHTML要素 (`canvasRefs`) への参照を保持します。
    -   ウィンドウの高さに基づいてキャンバスのサイズが動的に調整されます。
-   **オブジェクトの追加と操作:**
    -   **テキスト:** 「Add Text」ボタンで、"Tap to edit" という初期テキストを持つ `fabric.IText` オブジェクトをアクティブなキャンバスに追加できます。
    -   **画像:** ファイル入力から画像ファイルを選択し、キャンバスに追加できます。
    -   **選択とアクティブ化:** キャンバス上のオブジェクトをクリックすると、そのオブジェクトが選択状態 (`selectedObject`) になります。また、キャンバス自体をクリックすると、そのキャンバスがアクティブ (`activeCanvas`) になります。
    -   **プロパティ編集:**
        -   テキストオブジェクトを選択すると、サイドバーにフォントサイズと色のコントロールが表示され、リアルタイムで編集できます。
    -   **レイヤー操作:** 選択したオブジェクトを「前面へ (Bring Forward)」「背面へ (Send Backwards)」移動できます。
    -   **削除:** 選択したオブジェクトを「Delete」ボタンで削除できます。
-   **UI構成:**
    -   画面左側にコントロールパネル（サイドバー）が表示されます。ここには、ページの追加、テキスト・画像の追加、選択中オブジェクトの操作（削除、レイヤー変更、プロパティ編集）などのボタンが配置されます。
    -   画面中央から右側にかけて、手紙のページ（キャンバス）が縦に並んで表示されます。
    -   アクティブなページは青い枠線で強調表示されます。
-   **保存:**
    -   「Save」ボタンをクリックすると、現在アクティブなキャンバスの内容が `toJSON()` メソッドによってJSON形式に変換され、ブラウザのコンソールに出力されます。（現時点ではサーバーへの保存機能は実装されていません）。
